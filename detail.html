<html>
<head>
<title>Anime Detail</title>

<style>
:root {
  --bg: #0f1115;
  --panel: #181b23;
  --card: #1f2330;
  --primary: #2e51a2;
  --accent: #e50914;
  --text: #ffffff;
  --muted: #9ca3af;
}

* { box-sizing: border-box; }

body {
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
  background: var(--bg);
  color: var(--text);
}

header {
  padding: 16px 24px;
  background: linear-gradient(to right, var(--primary), #1c2a55);
}

header a {
  color: white;
  text-decoration: none;
  font-weight: bold;
}

.container {
  padding: 30px;
  display: grid;
  grid-template-columns: 220px 1fr;
  gap: 30px;
}

.poster img {
  width: 220px;
  border-radius: 8px;
}

.info h1 {
  margin-top: 0;
}

.info p {
  color: var(--muted);
  line-height: 1.5;
}

.info button {
  margin-top: 10px;
  padding: 10px;
  border: none;
  background: var(--accent);
  color: white;
  cursor: pointer;
  border-radius: 4px;
}

.recommend {
  margin-top: 40px;
}

.recommend-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
  gap: 15px;
}

.rec-card {
  background: var(--card);
  border-radius: 6px;
  overflow: hidden;
}

.rec-card img {
  width: 100%;
  height: 220px;
  object-fit: cover;
}

.rec-card div {
  padding: 8px;
  font-size: 13px;
}
</style>
</head>

<body>

<header>
  <a href="index.html">← Back to Home</a>
</header>

<div class="container">
  <div class="poster" id="poster"></div>
  <div class="info" id="info"></div>
</div>

<div class="recommend container">
  <div style="grid-column: 1 / -1;">
    <h2>Recommended Anime</h2>
    <div class="recommend-grid" id="recommendGrid"></div>
  </div>
</div>

<script>
const ANIME_API = "https://udinbanda.theokaitou.my.id";
const COLLECTION_API = "https://saber.theokaitou.my.id";


const params = new URLSearchParams(window.location.search);
const animeId = params.get("id");

if (!animeId) {
  document.body.innerHTML = "<h2>Anime ID not provided</h2>";
}

async function loadDetail() {
  const res = await fetch(`${ANIME_API}/anime/${animeId}`);
  const json = await res.json();
  const anime = json.data;

  document.getElementById("poster").innerHTML = `
    <img src="${anime.image_url}">
  `;

  document.getElementById("info").innerHTML = `
    <h1>${anime.title}</h1>
    <p><b>Score:</b> ${anime.score ?? "-"}</p>
    <p><b>Genres:</b> ${anime.genres.join(", ")}</p>
    <button onclick="addToCollection()">➕ Add to Collection</button>
  `;

  loadRecommendation();
}

async function addToCollection() {
  const userId = 1;

  await fetch(`${COLLECTION_API}/collection/add`, {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({
      userId,
      itemId: Number(animeId),
      mediaType: "anime",
      source: "external-api"
    })
  });

  alert("Added to collection!");
}

async function loadRecommendation() {
  const res = await fetch(`${ANIME_API}/recommend/${animeId}`);
  const json = await res.json();

  const grid = document.getElementById("recommendGrid");
  grid.innerHTML = "";

  json.recommendations.forEach(r => {
    const div = document.createElement("div");
    div.className = "rec-card";
    div.innerHTML = `
      <img src="${r.image_url}">
      <div>${r.title}</div>
    `;
    grid.appendChild(div);
  });
}

loadDetail();
</script>

</body>
</html>
